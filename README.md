# projectVoiceControl

- 我要做一个python程序 聆听用户语音 然后识别出角度信息 然后打印出角度 然后回答ok 比如 用户说 运动到90度 程序识别出90并打印出来 然后语音回答 ok 比如用户说运动到180度 程序识别出180并打印出来 然后语音回答 ok
- 运行环境windows
- 要求语音自然流畅逼真 避免机械感

## 项目简介
- 使用麦克风聆听中文语音，识别其中的角度信息（如“运动到90度”或“九十度”）。
- 程序打印识别出的角度，并用更自然的神经语音回复“ok”。

## 功能特性
- 连续对话：回复“ok”在后台播放，不阻塞下一轮聆听。
- 自然语音：使用 `edge-tts` 的中文神经语音（默认 `zh-CN-XiaoxiaoNeural`）。
- 角度识别：支持阿拉伯数字与中文数字，支持负数表达。
- 容错处理：修正常见 ASR 误识别，如“付200度”被识别为“负200度”。

## 环境要求
- `Windows`
- `Python 3.9+`
- 可用的麦克风设备
- 需要联网（使用 Google 语音识别 和 edge-tts 神经语音合成）

## 安装
1) 建议使用虚拟环境（可选）：
   - `python -m venv .venv`
   - `./.venv/Scripts/activate`

2) 安装依赖：
   - `pip install -r requirements.txt`
   - 若访问 PyPI 网络有问题，可使用镜像：
     - `pip install -i https://pypi.tuna.tsinghua.edu.cn/simple -r requirements.txt`
   - 如需单独安装 `playsound`（已在依赖中固定版本）：
     - `pip install -i https://pypi.tuna.tsinghua.edu.cn/simple playsound==1.2.2`

## 运行
- `python main.py`
- 开始后说：例如“运动到90度”、“把角度设为一百八十度”。
- 程序会：
  - 识别文本并从中提取角度整数；
  - 在终端打印出角度；
  - 以更自然的语音回复“ok”。

### 指令示例
- 正数（阿拉伯）：`运动到90度`、`设为180度`
- 正数（中文）：`九十度`、`一百八十度`
- 负数（阿拉伯）：`运动到-45度`、`-100度`
- 负数（中文）：`运动到负九十度`、`负的45度`

## 可配置项（在 main.py 顶部）
- 语音合成角色：`VOICE = "zh-CN-XiaoxiaoNeural"`（较自然的中文神经语音）
- 回复内容：`REPLY_TEXT = "ok"`（如需中文可改为`"好的"`）
 - 录音采样率与时长：`samplerate = 16000`、单次录音约 `5秒`

## 说明
- 识别支持阿拉伯数字（如“90度”）与常见中文数字（如“九十度”、“一百八十度”）。
- 麦克风录音采用 `sounddevice/soundfile`，无需安装 `PyAudio`。
- 若你需要离线识别或更高鲁棒性，可后续替换为 Vosk/Whisper 等方案（需下载模型）；当前实现优先满足自然语音回复与快速可用。

### 角度解析规则
- 阿拉伯数字：`90`、`180`、`-45`、`-100`（支持半角`-`、全角`－`、数学符号`−`）。
- 中文数字：`九十`、`一百八十`；支持负数前缀：`负九十`、`负的45`。
- 紧邻“度”优先：形如`90度`或`负90度`优先解析。

### 容错与规范化
- 统一负号字符到半角`-`。
- 常见误识别映射：`付`→`负`（例如“付200度”按“负200度”处理）。

### 语音回复机制
- 优先使用 `playsound` 播放缓存文件 `./.cache/reply_ok.mp3`。
- 若不可用，回退到 Windows Media Player COM；再次失败则尝试 `wmplayer.exe`；最终兜底为 `Invoke-Item` 打开默认播放器。
- 播放在后台线程执行，保证连续对话体验。

## 常见问题排查
- 没有听到“ok”：
  - 检查系统音量与默认输出设备；
  - 确认 Windows Media Player 未禁用（若走回退路径）；
  - 已安装 `playsound==1.2.2`；必要时通过镜像安装。
- 无法识别负数：
  - 使用“负90度”、“负的45度”或带负号的阿拉伯数字“-45度”；
  - 如果出现其它误识别前缀（如“复90度”、“夫90度”），可在规范化映射中新增。
- 识别失败或报网络错误：
  - 需联网（Google STT 与 edge-tts）；网络受限时使用镜像安装依赖。
- 麦克风不可用：
  - 检查 Windows 隐私设置中的麦克风权限；
  - 确认设备选择与采样率正常。